{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["var URL = require('url');\n\nmodule.exports = function (options) {\n  var parent = this;\n\n  var opts = typeof options === 'function' ? {custom: options} : options;\n  opts.useOriginalUrl = (typeof opts.useOriginalUrl === 'undefined') ? true : opts.useOriginalUrl;\n\n  return function (req, res, next) {\n    var url = URL.parse((opts.useOriginalUrl ? req.originalUrl : req.url) || req.url || '', true);\n\n    var skip = false;\n\n    if (opts.custom) {\n      skip = skip || opts.custom(req);\n    }\n\n    var paths = !opts.path || Array.isArray(opts.path) ?\n                opts.path : [opts.path];\n\n    if (paths) {\n      skip = skip || paths.some(function (p) {\n        return isUrlMatch(p, url.pathname) && isMethodMatch(p.methods, req.method);\n      });\n    }\n\n    var exts = (!opts.ext || Array.isArray(opts.ext)) ?\n               opts.ext : [opts.ext];\n\n    if (exts) {\n      skip = skip || exts.some(function (ext) {\n        return url.pathname.substr(ext.length * -1) === ext;\n      });\n    }\n\n    var methods = (!opts.method || Array.isArray(opts.method)) ?\n                  opts.method : [opts.method];\n\n    if (methods) {\n      skip = skip || !!~methods.indexOf(req.method);\n    }\n\n    if (skip) {\n      return next();\n    }\n\n    parent(req, res, next);\n  };\n};\n\nfunction isUrlMatch(p, url) {\n  var ret = (typeof p === 'string' && p === url) || (p instanceof RegExp && !!p.exec(url));\n  if (p instanceof RegExp) {\n    p.lastIndex = 0;\n  }\n\n  if (p && p.url) {\n    ret = isUrlMatch(p.url, url)\n  }\n  return ret;\n}\n\nfunction isMethodMatch(methods, m) {\n  if (!methods) {\n    return true;\n  }\n\n  methods = Array.isArray(methods) ? methods : [methods];\n\n  return !!~methods.indexOf(m);\n}\n"]}